var __extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}();define(["require","exports","../Holdem","../DZPKCardLogic","../../../mbase/base/MEffectView"],function(e,t,i,a,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var h=laya.maths.Point,n=function(e){function t(t){var i=e.call(this)||this;return i._PLAYER_NUM=9,i._my_seat=-1,i._vm=t,i}return __extends(t,e),t.prototype.beClose=function(){this.clearView()},t.prototype.onShowdown=function(e,t){this.eff.stopCircleEffect(),this.showPlayersCards(e),this.showResults(e),this.timerOnce(500,this,this.showWinCardsType,[t])},t.prototype.showWinCardsType=function(e){if(!(e.length<=0)){var t=e.pop(),i=t.cardsIndexs,a=t.centerCardIndexs,o=this.getPlayerSeat(t.seatNO);o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_tip").visible=!1,o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_tip").visible=!1;var h,n=0,s=i.length;for(n=0;n<s;n++)0==i[n]?(o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_tip").visible=!0,o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_tip").skin="dzpk/cards/cardTypeTip2.png",o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_zhao").visible=!0,1==s&&(o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_zhao").visible=!1)):(o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_tip").visible=!0,o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_tip").skin="dzpk/cards/cardTypeTip2.png",o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_zhao").visible=!0,1==s&&(o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_zhao").visible=!1));for(s=5,n=0;n<s;n++)(h=this.box_common_cards.getChildByName("box_card"+n)).getChildByName("img_chose").visible=!1;var l={count:s=a.length};for(n=0;n<s;n++)(h=this.box_common_cards.getChildByName("box_card"+a[n])).getChildByName("img_chose").visible=!0,h.getChildByName("img_chose").skin="dzpk/cards/cardTypeTip2.png",Laya.Tween.to(h,{y:10},200,null,laya.utils.Handler.create(this,this.onComCardsUP,[t.seatNO,h,e,l]))}},t.prototype.onComCardsUP=function(e,t,i,a){Laya.Tween.to(t,{y:30},200,null,laya.utils.Handler.create(this,this.onComCardsDown,[e,t,i,a]),1e3)},t.prototype.onComCardsDown=function(e,t,i,a){if(a.count--,0==a.count){this.getPlayerSeat(e);this.showWinCardsType(i),this.updataOperatePanel(0)}},t.prototype.onEarlyEnd=function(e){this.eff.stopCircleEffect(),this.showResults(e)},t.prototype.showResults=function(e){var t,i,a=0,o=e.length,n=[];for(a=0;a<o;a++)i=(t=this.getPlayerSeat(e[a].seatNO)).localToGlobal(new h(.5*t.getChildByName("ui_player").width,.5*t.getChildByName("ui_player").height)),e[a].getScoreCount>0?(this.eff.succType(e[a].cardType,i),this.eff.numberFloat(e[a].bet,!0,i),n.push(i)):this.eff.numberFloat(e[a].bet,!1,i);this.choumaHeGuan(),this.timerOnce(300,this,this.dealyChouma,[n])},t.prototype.dealyChouma=function(e){var t=this.txt_dichi.localToGlobal(new h(0,0)),i=0,a=e.length;for(a=e.length,i=0;i<a;i++)this.eff.choumaEffect(t,e[i]);this.box_dichi.visible=!1,this.txt_dichi.text="",this.updataOperatePanel(0)},t.prototype.showCardTypeTip=function(e,t,i,a){var o=this.getPlayerSeat(e);if(o.getChildByName("box_type").visible=!0,o.getChildByName("box_type").getChildByName("img_type").skin="dzpk/zh-cn/font/cardTypeFont/cardType_"+t+".png",e==this._my_seat){var h=0,n=void 0,s=void 0;for(o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_tip").visible=!1,o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_tip").visible=!1,n=i.length,h=0;h<n;h++)0==i[h]?(o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_tip").visible=!0,o.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_tip").skin="dzpk/cards/cardTypeTip1.png"):(o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_tip").visible=!0,o.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_tip").skin="dzpk/cards/cardTypeTip1.png");for(n=5,h=0;h<n;h++)(s=this.box_common_cards.getChildByName("box_card"+h)).getChildByName("img_chose").visible=!1;for(n=a.length,h=0;h<n;h++)(s=this.box_common_cards.getChildByName("box_card"+a[h])).getChildByName("img_chose").visible=!0,s.getChildByName("img_chose").skin="dzpk/cards/cardTypeTip1.png"}},t.prototype.onShowBank=function(e){this.getPlayerSeat(e).getChildByName("img_banker").visible=!0},t.prototype.sendCards=function(e){var t,i,a,o,h=0,n=e.length,s=[];for(h=0;h<n;h++)t=e[h],i=this.getPlayerSeat(t.seatNO),s.push(new laya.maths.Point(i.x+.5*i.width,i.y+.5*i.height)),this._my_seat==t.seatNO&&(a=s.length-1,o=t);this.eff.heguanfapaiEffect(s,new laya.maths.Point(this.img_heguan.x+.5*this.img_heguan.width,this.img_heguan.y+.5*this.img_heguan.height),a,this.updatePlayerCards,[o.hole1,o.hole2,o.seatNO],this)},t.prototype.onShowCard=function(e){this.eff.stopCircleEffect(),this.showPlayersCards(e)},t.prototype.showPlayersCards=function(e){var t,a,o=0,h=e.length;for(o=0;o<h;o++){t=e[o];var n=(a=this.getPlayerSeat(t.seatNO)).getChildByName("box_cards").localToGlobal(new laya.maths.Point(0,0));t.seatNO!=this._my_seat&&t.action!=i.TEXAS_HOLDEM_ACTION.FOLD&&(a.getChildByName("box_cards").visible=!1,this.eff.fanpai(n,this.updatePlayerCards,[t.hole1,t.hole2,t.seatNO],this))}},t.prototype.updatePlayerCards=function(e,t,i,o){void 0===o&&(o=!0);var h=this.getPlayerSeat(i);h.getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_card").skin=CFun.format("dzpk/cards/card_{0}.png",a.DZPKCardLogic.ins.cardValuetToClient(e)),h.getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_card").skin=CFun.format("dzpk/cards/card_{0}.png",a.DZPKCardLogic.ins.cardValuetToClient(t)),i!=this._my_seat&&(h.getChildByName("box_cards").x=h.getChildByName("box_fan").x,h.getChildByName("box_cards").y=h.getChildByName("box_fan").y,h.getChildByName("box_cards").scaleX=1,h.getChildByName("box_cards").scaleY=1),h.getChildByName("box_cards").visible=!0,h.getChildByName("box_cards").getChildByName("box_rcard").visible=!!o,h.getChildByName("box_type").getChildByName("img_type")},t.prototype.updateTablePool=function(e){this.box_dichi.visible=!0,this.txt_dichi.text=CFun.formatCurrency(e)},t.prototype.updatePublicCards=function(e,t,i){this.choumaHeGuan(),this.showPublicCard(e,t,i,null)},t.prototype.choumaHeGuan=function(){var e=0,t=this._PLAYER_NUM,i=[];for(e=0;e<t;e++)this["box_player"+e].visible&&this["box_player"+e].getChildByName("box_blind").visible&&(this["box_player"+e].getChildByName("box_blind").visible=!1,this["box_player"+e].getChildByName("box_blind").getChildByName("txt_blind").text="",i.push(this["box_player"+e].getChildByName("box_blind").localToGlobal(new h(0,0))));this.eff.choumaHeguan(i,this.txt_dichi.localToGlobal(new h(0,0)))},t.prototype.showPublicCard=function(e,t,i,o){if(o&&(o.visible=!0),!(t>i)){var h,n=a.DZPKCardLogic.ins.cardValuetToClient(e[t]);if(n>0){(h=this.box_common_cards.getChildByName("box_card"+t)).getChildByName("img_card").skin=CFun.format("dzpk/cards/card_{0}.png",n);var s=h.localToGlobal(new laya.maths.Point(0,0)),l=new laya.maths.Point(this.img_heguan.x+.5*this.img_heguan.width,this.img_heguan.y+.5*this.img_heguan.height);this.eff.comFanpai(s,l,this.showPublicCard,[e,++t,i,h],this)}}},t.prototype.updataOperatePanel=function(e,t){e>=0?(this.vs_state.visible=!0,this.vs_state.selectedIndex=e,1==e?(this.box_slid.visible=!1,this.updateGenButton(t),this.cb_gen.selected=this.cb_gen_all.selected=this.cb_qi.selected=!1):2==e&&this.updateAutoGenButton(t)):this.vs_state.visible=!1},t.prototype.updateAutoGenButton=function(e){var t=e.miniBet-e.bet;t>0?t<e.chip?this.cb_gen.label=CFun.format(CFun.getItem(MsgData,"id",4032).msg,CFun.formatCurrency(t-e.stageBet)):this.cb_gen.label=CFun.getItem(MsgData,"id",4033).msg:t<=0&&(this.cb_gen.label=CFun.getItem(MsgData,"id",4019).msg)},t.prototype.updateGenButton=function(e){var t=e.miniBet-e.bet,i=t+e.miniRaise;this.box_slid.visible=!1,this.btn_allin.money=e.chip,this.btn_mu10.money=Math.floor(e.pot),this.btn_mu10.label=CFun.formatCurrency(this.btn_mu10.money),this.btn_mu5.money=Math.floor(.67*e.pot),this.btn_mu5.label=CFun.formatCurrency(this.btn_mu5.money),this.btn_mu3.money=Math.floor(.5*e.pot),this.btn_mu3.label=CFun.formatCurrency(this.btn_mu3.money),this.btn_mu3.mouseEnabled=this.btn_mu3.money<=e.chip&&this.btn_mu3.money>=i,this.btn_mu5.mouseEnabled=this.btn_mu5.money<=e.chip&&this.btn_mu5.money>=i,this.btn_mu10.mouseEnabled=this.btn_mu10.money<=e.chip&&this.btn_mu10.money>=i,this.sid_money.min=i,this.sid_money.max=e.chip,this.sid_money.value=this.sid_money.min,this.cb_gen.selected?this.vm.addScore(t):this.cb_gen_all.selected?this.vm.addScore(t):this.cb_qi.selected?0==t?this.vm.addScore(t):this.vm.fold():(0==t?this.btn_follow.getChildByName("img_type").skin="dzpk/zh-cn/font/buttonFont/rangpaiFont.png":t>=e.chip?this.btn_follow.getChildByName("img_type").skin="dzpk/zh-cn/font/buttonFont/allInFont.png":this.btn_follow.label=CFun.formatCurrency(t),this.btn_follow.money=t)},t.prototype.showWait=function(e){var t=e.seatNO,i=this.getPlayerSeat(t).getChildByName("ui_player").getChildByName("box_info").getChildByName("box_head"),a=i.localToGlobal(new laya.maths.Point(0,0));i.width;this.eff.circleEffect(e.cd,62,a.x,a.y,null,this)},t.prototype.showPlay=function(e){this.eff.stopCircleEffect();var t=e.action,a=(e.bet,e.seatNO),o=this.getPlayerSeat(a);this.updatePlayerAmount(o.getChildByName("box_blind"),e.amount),o.getChildByName("ui_player").getChildByName("box_info").getChildByName("box_name").getChildByName("txt_money").text=CFun.formatCurrency(e.chip);var n=o.getChildByName("ui_player").getChildByName("box_operator");n.visible=0!=t;var s=n.getChildByName("img_operator");if(0==e.chip)s.skin="dzpk/zh-cn/font/operateActionFont/operateAction_AllIn.png";else{var l=void 0,r=void 0;switch(t){case i.TEXAS_HOLDEM_ACTION.ANTE:break;case i.TEXAS_HOLDEM_ACTION.SMALL_BLINK:s.skin="dzpk/zh-cn/font/operateActionFont/operateAction_xiaomangzhu.png";break;case i.TEXAS_HOLDEM_ACTION.BIG_BLINK:s.skin="dzpk/zh-cn/font/operateActionFont/operateAction_damangzhu.png";break;case i.TEXAS_HOLDEM_ACTION.CALL:s.skin="dzpk/zh-cn/font/operateActionFont/operateAction_genzhu.png";break;case i.TEXAS_HOLDEM_ACTION.RAISE:s.skin="dzpk/zh-cn/font/operateActionFont/operateAction_jiazhu.png";break;case i.TEXAS_HOLDEM_ACTION.PASS:s.skin="dzpk/zh-cn/font/operateActionFont/operateAction_guopai.png";break;case i.TEXAS_HOLDEM_ACTION.FOLD:s.skin="dzpk/zh-cn/font/operateActionFont/operateAction_qipai.png",this.eff.stopCircleEffect(),o.alpha=.5,r=o.localToGlobal(new h(.5*o.getChildByName("ui_player").width,.5*o.getChildByName("ui_player").height)),l=new h(.5*this.stage.width,.5*this.stage.height),this.eff.qipaiEffect(r,l),a==this._my_seat&&this.updataOperatePanel(0)}e.amount>0&&(r=o.localToGlobal(new h(.5*o.getChildByName("ui_player").width,.5*o.getChildByName("ui_player").height)),l=o.getChildByName("box_blind").localToGlobal(new h(0,0)),this.eff.choumaEffect(r,l))}},t.prototype.updatePlayerAmount=function(e,t){var i=parseInt(e.getChildByName("txt_blind").text);((i=i>0?i:0)>0||t>0)&&(e.visible=!0,e.getChildByName("txt_blind").text=CFun.formatCurrency(i+t))},t.prototype.showGameInfo=function(e,t){this.txt_blind.text=CFun.format(CFun.getItem(MsgData,"id",4026).msg,CFun.formatCurrency(e),CFun.formatCurrency(2*e)),t>0&&(this.txt_blind.text=this.txt_blind.text+CFun.format(CFun.getItem(MsgData,"id",4005).msg,CFun.formatCurrency(t)))},t.prototype.showGameNo=function(e){this.txt_game_id.text=e},t.prototype.showPlayerChip=function(e,t){this.getPlayerSeat(t).getChildByName("ui_player").getChildByName("box_info").getChildByName("box_name").getChildByName("txt_money").text=CFun.formatCurrency(e)},t.prototype.showPlayers=function(e,t){this._my_seat=t;var i=0,a=e.length;for(i=0;i<a;i++)this.showPlayer(e[i])},t.prototype.showPlayer=function(e){var t=this.getPlayerSeat(e.seatNO);t.visible=!0,t.getChildByName("ui_player").getChildByName("box_info").getChildByName("box_name").getChildByName("txt_nickname").text=e.name,t.getChildByName("ui_player").getChildByName("box_info").getChildByName("box_name").getChildByName("txt_money").text=e.chip,t.getChildByName("ui_player").getChildByName("box_info").getChildByName("box_head").getChildByName("img_head").skin="gamehall/avater/"+(1==e.sex?"man":"women")+e.icon+".png"},t.prototype.getPlayerSeat=function(e){-1==this._my_seat&&CFun.throw("DZPKSceneView中玩家的索引this._my_index还未确定");return this["box_player"+(e+this._PLAYER_NUM-this._my_seat)%this._PLAYER_NUM]},t.prototype.clearView=function(){this.eff.removeOver(),this.box_dichi.visible=!1,this.txt_dichi.text="",this.txt_game_id.text="";var e=0,t=this._PLAYER_NUM;for(e=0;e<t;e++)this["box_player"+e].getChildByName("img_banker").visible=!1,this["box_player"+e].alpha=1,0!=e?(this["box_player"+e].visible=!1,this["box_player"+e].getChildByName("box_cards").x=this["box_player"+e].getChildByName("box_gai").x,this["box_player"+e].getChildByName("box_cards").y=this["box_player"+e].getChildByName("box_gai").y,this["box_player"+e].getChildByName("box_cards").scaleX=.5,this["box_player"+e].getChildByName("box_cards").scaleY=.5):(this["box_player"+e].visible=!0,this["box_player"+e].getChildByName("box_cards").visible=!1),this["box_player"+e].getChildByName("ui_player").getChildByName("box_info").getChildByName("box_name").getChildByName("txt_money").text="0",this["box_player"+e].getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_zhao").visible=!1,this["box_player"+e].getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_tip").visible=!1,this["box_player"+e].getChildByName("box_cards").getChildByName("box_lcard").getChildByName("img_card").skin="dzpk/cards/card_0.png",this["box_player"+e].getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_zhao").visible=!1,this["box_player"+e].getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_tip").visible=!1,this["box_player"+e].getChildByName("box_cards").getChildByName("box_rcard").getChildByName("img_card").skin="dzpk/cards/card_0.png",this["box_player"+e].getChildByName("box_blind").visible=!1,this["box_player"+e].getChildByName("box_type").visible=!1,this["box_player"+e].getChildByName("ui_player").getChildByName("box_operator").visible=!1;for(e=0;e<5;e++)Laya.Tween.clearAll(this.box_common_cards.getChildByName("box_card"+e)),this.box_common_cards.getChildByName("box_card"+e).visible=!1,this.box_common_cards.getChildByName("box_card"+e).getChildByName("img_chose").visible=!1},t.prototype.onOpenMenu=function(){this.vm.showMenu()},t.prototype.viewInit=function(e){this.clearView(),this.box_player0.getChildByName("ui_player").getChildByName("box_info").getChildByName("box_name").getChildByName("txt_nickname").text=e.name,this.box_player0.getChildByName("ui_player").getChildByName("box_info").getChildByName("box_head").getChildByName("img_head").skin="gamehall/avater/"+(1==e.sex?"man":"women")+e.icon+".png"},t.prototype.onPiPei=function(){this.box_dichi.visible?this.vm.quit():this.vm.sendPiPei(),this._my_seat=-1,this.clearView()},t.prototype.onAddChange=function(){this.txt_money.text=CFun.formatCurrency(this.sid_money.value)},t.prototype.onShowAddPanel=function(){this.box_slid.visible?this.vm.addScore(this.sid_money.value):this.box_slid.visible=!0},t.prototype.onOperator=function(e){var t=e.currentTarget;t==this.btn_allin?this.vm.addScore(this.btn_allin.money):t==this.btn_follow?this.vm.addScore(this.btn_follow.money):t==this.btn_mu10?this.vm.addScore(this.btn_mu10.money):t==this.btn_mu5?this.vm.addScore(this.btn_mu5.money):t==this.btn_mu3?this.vm.addScore(this.btn_mu3.money):t==this.btn_qipai&&this.vm.fold()},t.prototype.onAutoOperator=function(e){var t=e.currentTarget;t.selected&&(t==this.cb_gen?this.cb_qi.selected=this.cb_gen_all.selected=!1:t==this.cb_qi?this.cb_gen.selected=this.cb_gen_all.selected=!1:this.cb_gen.selected=this.cb_gen.selected=!1)},t.prototype.comInit=function(){this.btn_menu.on(Laya.Event.CLICK,this,this.onOpenMenu),this.btn_pipei.on(Laya.Event.CLICK,this,this.onPiPei),this.btn_add.on(Laya.Event.CLICK,this,this.onShowAddPanel),this.btn_allin.on(Laya.Event.CLICK,this,this.onOperator),this.btn_follow.on(Laya.Event.CLICK,this,this.onOperator),this.btn_mu10.on(Laya.Event.CLICK,this,this.onOperator),this.btn_mu3.on(Laya.Event.CLICK,this,this.onOperator),this.btn_mu5.on(Laya.Event.CLICK,this,this.onOperator),this.btn_qipai.on(Laya.Event.CLICK,this,this.onOperator),this.cb_gen.on(Laya.Event.CLICK,this,this.onAutoOperator),this.cb_qi.on(Laya.Event.CLICK,this,this.onAutoOperator),this.cb_gen_all.on(Laya.Event.CLICK,this,this.onAutoOperator),this.sid_money.on(Laya.Event.CHANGE,this,this.onAddChange)},Object.defineProperty(t.prototype,"eff",{get:function(){return o.MEffectView.ins.dzpk},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"vm",{get:function(){return this._vm||CFun.throw("ComView中_vm还未初始化！"),this._vm},enumerable:!0,configurable:!0}),t}(ui.game_dzpk.DZPKSceneUI);t.DZPKSceneView=n});